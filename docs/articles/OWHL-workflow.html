<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OWHL file handling • owhlR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="OWHL file handling">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">owhlR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/OWHL-workflow.html">OWHL file handling</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/millerlp/owhlR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="OWHL-workflow_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>OWHL file handling</h1>
                        <h4 class="author">Luke Miller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/millerlp/owhlR/blob/master/vignettes/OWHL-workflow.Rmd"><code>vignettes/OWHL-workflow.Rmd</code></a></small>
      <div class="hidden name"><code>OWHL-workflow.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>owhlR</code> package was originally created to support the post-processing workflow of the Open Wave Height Logger (OWHL) project. The package contains functions to assist in combining raw csv files from a OWHL device, and this vignette contains a walkthrough of the steps involved in proceeding from raw pressure data contained in an OWHL csv file to a time series of sea surface elevation data that can be used to generate oecan wave statistics.</p>
</div>
<div id="starting-out" class="section level1">
<h1 class="hasAnchor">
<a href="#starting-out" class="anchor"></a>Starting out</h1>
<p>The <code>owhlR</code> package relies on functions contained in the <code>oceanwaves</code> package, and further dependencies of that package.</p>
<p>Begin by installing the <code>oceanwaves</code> package, if not already installed. The <code>oceanwaves</code> package makes use of several other packages that may also need to be installed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'oceanwaves'</span>)</span></code></pre></div>
<p>Load the installed package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(oceanwaves)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#&gt; Loading required package: ggplot2</span></span></code></pre></div>
</div>
<div id="importing-owhl-csv-files" class="section level1">
<h1 class="hasAnchor">
<a href="#importing-owhl-csv-files" class="anchor"></a>Importing OWHL csv files</h1>
<p>The Open Wave Height Logger produces daily data files, in a comma-separated-value (.csv) format. Those files contain a header row with optional deployment information, along with a row of column headers. The import process would normally begin by generating a vector of filenames (include file path) that you want to join. The <code><a href="https://rdrr.io/r/base/list.files.html">dir()</a></code> function can be used to generate the set of filenames.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>filenames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="dt">path=</span><span class="st">"./path/to/your/files"</span>, <span class="dt">pattern =</span> <span class="st">'*.csv'</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)</span></code></pre></div>
<p>The set of filenames can be passed to the <code>joinOWHLfiles</code> function. This function has an argument <code>timezone</code> (default <code>timezone = UTC</code>) used to set the time zone of the time stamps contained in the OWHL data files. If the clock of your OWHL was set to a time zone other than UTC, then supply the appropriate time zone name for your clock. For example, if your OWHL clock was instead set to Pacific Standard Time during the deployment, you would set the argument as <code>timezone = 'etc/GMT+8'</code>. Verbose output for the file import can be turned on with the <code>verbose = TRUE</code> argument.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>myTimeZone =<span class="st"> 'UTC'</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>dat =<span class="st"> </span>owhlR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/owhlR/man/joinOWHLfiles.html">joinOWHLfiles</a></span>(filenames, <span class="dt">timezone =</span> myTimeZone, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p>The <code>joinOWHLfiles</code> function consists of several steps:</p>
<ul>
<li>Grab mission info (if present) from the header of the 1st csv file. This assumes that mission info is the same in all input files, which is the case if all files came from a single deployment of the OWHL.</li>
<li>Read in each csv file in a loop.</li>
<li>The human-readable timestamp data in a csv file’s DateTime column are converted to POSIXct time format with the desired time zone.</li>
<li>The DateTime values then have the fractional seconds appended based on the values in the <code>frac.seconds</code> column of the csv file.</li>
<li>Concatenates the data from all input csv files and reorders them based on the DateTime column</li>
<li>Any suspect time values (based on the <code>frac.seconds</code> column values) are filtered and removed from the data set.</li>
<li>Any 1 second gaps in the data set are filled by linear interpolation. These gaps arise in the raw data files when a micro SD card takes longer than the sample interval (default 0.25 seconds) to carry out its internal housekeeping routines. Longer gaps are assumed to be due to other issues and are not filled. The pressure data and temperature data are filled by linear interpolation from the values immediately before and after the missing second of data.</li>
</ul>
<p>After carrying out these steps, a data frame is returned. The data frame should contain the same columns as the original input csv files.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dat)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt;       POSIXt            DateTime frac.seconds Pressure.mbar TempC</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; 1 1471630800 2016-08-19 18:20:00            0        1029.3 30.44</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; 2 1471630800 2016-08-19 18:20:00           25        1029.6 30.44</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt; 3 1471630800 2016-08-19 18:20:00           50        1029.0 30.44</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt; 4 1471630800 2016-08-19 18:20:00           75        1028.5 30.45</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; 5 1471630801 2016-08-19 18:20:01            0        1029.0 30.44</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; 6 1471630801 2016-08-19 18:20:01           25        1029.0 30.44</span></span></code></pre></div>
</div>
<div id="converting-pressure-to-sea-surface-elevation" class="section level1">
<h1 class="hasAnchor">
<a href="#converting-pressure-to-sea-surface-elevation" class="anchor"></a>Converting pressure to sea surface elevation</h1>
<div id="removing-atmospheric-pressure-and-sensor-offset" class="section level2">
<h2 class="hasAnchor">
<a href="#removing-atmospheric-pressure-and-sensor-offset" class="anchor"></a>Removing atmospheric pressure and sensor offset</h2>
<p>The <code>Pressure.mbar</code> values in the resulting data frame are absolute pressures in millibar. This includes the pressure signal due to the air above the sea surface, which we will need to remove from the data in order to get only the pressure due to the column of water above the OWHL sensor. You will need to obtain a sea level pressure data set from an outside source in order to perform this compensation. The sea level atmospheric pressure could come from a variety of sources including nearby weather stations. Ideally this would be a time series of atmospheric pressure records that overlaps with the OWHL time series.</p>
<p>For this example, we will use an example sea level air pressure dataset, measured in millibar, sampled at roughly 5 minute intervals. Actual historic air pressure data for various sites in the United States can be downloaded from a repository such as <a href="http://mesowest.utah.edu" class="uri">http://mesowest.utah.edu</a>. You may need to register an account there in order to download longer term air pressure data sets.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Define the path and file name for the air pressure data set</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>weatherfile =<span class="st"> "./Weather_data/201608_airpressure.csv"</span></span></code></pre></div>
<p>Import the air pressure data file. The example file has a column <code>DateTime</code> containing the date and time stamps, in the UTC time zone, and a column <code>SeaLevelPressure.mbar</code> with the sea level air pressure in millibar, which matches the OWHL measurement units. If your air pressure data are recorded in Pascals, simply divide by 100 to convert Pascals to millibar.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Read in the air pressure data</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>weather =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(weatherfile)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(weather)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt;               DateTime SeaLevelPressure.mbar</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; 1 08/19/2016 18:00 UTC              1013.496</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; 2 08/19/2016 18:05 UTC              1013.490</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; 3 08/19/2016 18:10 UTC              1013.490</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; 4 08/19/2016 18:15 UTC              1013.490</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; 5 08/19/2016 18:20 UTC              1013.490</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; 6 08/19/2016 18:25 UTC              1013.490</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co"># Convert the DateTime column to a POSIXct format</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>weather<span class="op">$</span>DateTime =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(weather<span class="op">$</span>DateTime, <span class="dt">format =</span> <span class="st">"%m/%d/%Y %H:%M"</span>, </span>
<span id="cb7-13"><a href="#cb7-13"></a>                <span class="dt">tz =</span> <span class="st">'UTC'</span>)</span></code></pre></div>
<p>The sea level air pressure data will often be reported on a somewhat irregular interval, usually around 5 minutes, but often with longer gaps. Because this won’t match the 4 Hz sampling rate of the OWHL data, we’ll want to linearly interpolate the air pressure data to match the OWHL interval. We’ll make use of functions in the <code>zoo</code> package, which is one of the packages <code>owhlR</code> depends on.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(zoo)</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="co">#&gt; </span></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co">#&gt; Attaching package: 'zoo'</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="co">#&gt; </span></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co">#&gt;     as.Date, as.Date.numeric</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Convert OWHL data set, sampled at a higher frequency, to a zoo object</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>ref =<span class="st"> </span><span class="kw">zoo</span>(dat[,<span class="st">'Pressure.mbar'</span>], <span class="dt">order.by =</span> dat[,<span class="st">'DateTime'</span>])</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># Air pressure data, lower frequency, convert to a zoo object</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>air =<span class="st"> </span><span class="kw">zoo</span>(weather[,<span class="st">'SeaLevelPressure.mbar'</span>],  </span>
<span id="cb9-5"><a href="#cb9-5"></a>        <span class="dt">order.by =</span> weather<span class="op">$</span>DateTime)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co"># Linearly interpolate the data in 'air' to match the time index in 'ref',</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># which should be 4 Hz, starting and ending when the OWHL data set starts and</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># ends</span></span>
<span id="cb9-9"><a href="#cb9-9"></a>airout =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/window.html">window</a></span>(<span class="kw">na.approx</span>(<span class="kw"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(ref,air)),<span class="kw">index</span>(ref))</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co"># Copy the resulting sea level pressure data into 'dat' data frame</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>dat<span class="op">$</span>SeaLevelPress.mbar =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(airout<span class="op">$</span>air), <span class="dt">digits=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Once we have the interpolated sea level air pressure data in our data frame, we can subtract off the air pressure signal from each pressure reading in the OWHL data set.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Call the new column swPressure.mbar for "seawater pressure"</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>dat<span class="op">$</span>swPressure.mbar =<span class="st"> </span>dat<span class="op">$</span>Pressure.mbar <span class="op">-</span><span class="st"> </span>dat<span class="op">$</span>SeaLevelPress.mbar</span></code></pre></div>
<p>It is also important to judge whether the OWHL sensor had any pressure offset due to factors such as manufacturing variance in the pressure sensor chip or residual pressure in the oil-filled bladder attached to the sensor (if used). One method to remove any offset is to compare a set of pressure readings from the data set while the OWHL was at the sea surface just prior to deployment underwater. Ideally the value recorded by the OWHL at the ocean surface would be equivalent to the local atmospheric pressure, but any difference that exists can be removed from the entire timeseries.</p>
<p>Here we’ll define a time value when the OWHL was known to be at the ocean surface, in the boat, just before being taken underwater. Then we find the row index in the <code>dat</code> data frame that is closest to that time stamp, and extract 10 seconds of data (40 samples at 4 Hz), and calculate the average pressure reading. This assumes that you have included the data from the surface period prior to the deployment, which we will remove at a later step. To estimate the pressure offset in the sensor, we will use the sea level pressure data for the same time point, which we previously imported and added to our dataset in the <code>dat$SeaLevelPress.mbar</code> column.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Define a time value for a surface reading for OWHL prior to </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># the start of the subsurface deployment</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>owhlSurfaceTime =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="st">'2016-08-19 18:25'</span>, <span class="dt">tz =</span> <span class="st">'UTC'</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># Find the row index of the timestamp in the dataset that is</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co"># closest to the surface time we just created</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>surfaceIndx =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(dat<span class="op">$</span>DateTime <span class="op">-</span><span class="st"> </span>owhlSurfaceTime))</span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co"># Grab 10 seconds of surface pressure readings. This will be used to determine</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co"># any pressure offset in the sensor, when compared to local sea surface air</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co"># pressure at the time of deployment.</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>surfaceOWHLPress =<span class="st"> </span>dat<span class="op">$</span>Pressure.mbar[surfaceIndx<span class="op">:</span>(surfaceIndx<span class="op">+</span><span class="dv">40</span>)]</span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co"># Round off to a sensible number of significant figures</span></span>
<span id="cb11-14"><a href="#cb11-14"></a>surfaceOWHLPress =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(surfaceOWHLPress),<span class="dt">dig=</span><span class="dv">1</span>)</span>
<span id="cb11-15"><a href="#cb11-15"></a></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co"># Calculate the offset from the known sea level atmospheric pressure</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co"># (usally obtained from a weather station). In this case, we'll use</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># the air pressure data we imported, and get the pressure value for the </span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co"># matching time points</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>atmosPressure.mbar =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(dat<span class="op">$</span>SeaLevelPress.mbar[surfaceIndx<span class="op">:</span>(surfaceIndx<span class="op">+</span><span class="dv">40</span>)]))</span>
<span id="cb11-21"><a href="#cb11-21"></a></span>
<span id="cb11-22"><a href="#cb11-22"></a>offsetValue =<span class="st"> </span>surfaceOWHLPress <span class="op">-</span><span class="st"> </span>atmosPressure.mbar</span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co"># Ideally offsetValue is 0, but it should typically be a few 10's of mbar</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="co"># unless your sensor had a major pressure offset.</span></span>
<span id="cb11-25"><a href="#cb11-25"></a></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="co"># Subtract offsetValue from all pressure values</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>dat<span class="op">$</span>swPressure.mbar =<span class="st"> </span>dat<span class="op">$</span>swPressure.mbar <span class="op">-</span><span class="st"> </span>offsetValue</span></code></pre></div>
<p>After subtracting off the atmospheric pressure and any offset from the absolute pressure values in the raw data files, we are left with the gauge pressure, that is the pressure due only to the water column above the pressure sensor (with the caveat that strong currents could impinge on a sensor port strongly enough to induce a small pressure signal that isn’t due purely to the pressure head above the sensor).</p>
</div>
<div id="isolate-the-subsurface-portion-of-the-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#isolate-the-subsurface-portion-of-the-dataset" class="anchor"></a>Isolate the subsurface portion of the dataset</h2>
<p>Now would be a reasonable time to subset out only the data from the underwater portion of the deployment, if there are pre- and post-deployment data currently in the <code>dat</code> data frame. Define a set of time stamps that mark when the OWHL was securely mounted in its fixture near the seafloor. Then use those time stamps to remove data before or after the deployment.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Create timestamps when the sensor was in place on the seafloor</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>owhlDeployStartTime =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="st">'2016-08-19 18:58'</span>, <span class="dt">tz =</span> <span class="st">'UTC'</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>owhlDeployEndTime =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(<span class="st">'2016-09-27 19:10'</span>, <span class="dt">tz =</span> <span class="st">'UTC'</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="co"># Remove all surface data prior to deployment and after end</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>dat =<span class="st"> </span>dat[dat<span class="op">$</span>DateTime <span class="op">&gt;=</span><span class="st"> </span>owhlDeployStartTime,]</span>
<span id="cb12-7"><a href="#cb12-7"></a>dat =<span class="st"> </span>dat[dat<span class="op">$</span>DateTime <span class="op">&lt;=</span><span class="st"> </span>owhlDeployEndTime,]</span></code></pre></div>
</div>
<div id="convert-pressure-to-sea-surface-elevation" class="section level2">
<h2 class="hasAnchor">
<a href="#convert-pressure-to-sea-surface-elevation" class="anchor"></a>Convert pressure to sea surface elevation</h2>
<p>To convert pressure values to sea surface elevation (height of the water column above the sensor), we’ll use the <code>millibarToSeawater</code> function, which is a wrapper around the <code>swDepth</code> function from the <code>oce</code> package (Kelley &amp; Richards, 2019, <a href="https://CRAN.R-project.org/package=oce" class="uri">https://CRAN.R-project.org/package=oce</a>). The defaults for the <code>swDepth</code> function are used, which call the <code>gsw_z_from_p()</code> function from the package <code>gsw</code>, which is based on from the 75-term equation for specific volume described at <a href="http://www.teos-10.org/" class="uri">http://www.teos-10.org/</a> (Thermodynamic Equation of Seawater 2010). This conversion relies on knowing the latitude where the pressure data were collected, so you need to provide that value as either a positive (Northern Hemisphere) or negative (Southern Hemisphere) decimal value. Note that this method does not compensate for actual seawater density at your field site.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Create a new column in dat with the estimated depth calculated</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="co"># from the pressure in millibar. The latitude of the example</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="co"># deployment was approximately 33.72 (degrees North).</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>dat<span class="op">$</span>swDepth.m =<span class="st"> </span>owhlR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/owhlR/man/millibarToSeawater.html">millibarToSeawater</a></span>(dat<span class="op">$</span>swPressure.mbar, <span class="dt">latitude =</span> <span class="fl">33.72</span>)</span></code></pre></div>
</div>
<div id="correcting-for-pressure-attenuation" class="section level2">
<h2 class="hasAnchor">
<a href="#correcting-for-pressure-attenuation" class="anchor"></a>Correcting for pressure attenuation</h2>
<p>If your sea surface elevation data were produced by a pressure transducer data logger mounted near the sea floor (such as the Open Wave Height Logger), rather than a surface buoy, the dynamic pressure signal that the data logger records will be muted to some degree depending on the depth of the data logger and the wave period. As a result, the sea surface elevation record from the bottom-mounted sensor will be an underestimate of what the actual height of the water column above the sensor was, and this underestimate gets worse as the depth of the sensor increases or the wave period gets shorter. The <code>oceanwaves</code> package provides a function <code>prCorr</code> that attempts to correct for this pressure signal attenuation and thus better recreate the actual water surface height fluctuations (a.k.a. waves).</p>
<p>The <code>prCorr</code> function needs a few arguments to work. In addition to the vector of sea surface elevations (in meters), you also need to provide the sampling frequency <code>Fs</code> for the data logger (4 Hz, i.e. 4 samples per second, in our example dataset), and the height <code>zpt</code> of the data logger above the sea floor in units of meters. The height of the pressure sensor above the sea floor matters because the height of waves at the surface is driven by their interaction with the seafloor, and the pressure signal attenuation is also a function of where in the water column the sensor sits. In many cases the sensor will be situated just above the seafloor, but there may be cases where the pressure sensor is strapped to a pier piling or other platform much closer to the surface than the seafloor. For the example data set, the sensor height above the seafloor <code>zpt</code> was 0.1 meters (10 cm).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Define the sampling rate for the example data set</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>Fs =<span class="st"> </span><span class="dv">4</span>  <span class="co"># units of Hz (samples per second)</span></span>
<span id="cb14-3"><a href="#cb14-3"></a></span>
<span id="cb14-4"><a href="#cb14-4"></a>dat<span class="op">$</span>swDepthCorrected.m =<span class="st"> </span><span class="kw">prCorr</span>(dat<span class="op">$</span>swDepth.m, <span class="dt">Fs =</span> Fs, <span class="dt">zpt =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p>We’ll plot the corrected data and the uncorrected data on the same plot to show how the pressure attenuation correction changes the estimated sea surface elevations.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Plot the de-attenuated data</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> dat<span class="op">$</span>DateTime, </span>
<span id="cb15-3"><a href="#cb15-3"></a>     <span class="dt">y =</span> dat<span class="op">$</span>swDepthCorrected.m, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'red'</span>, </span>
<span id="cb15-4"><a href="#cb15-4"></a>     <span class="dt">ylab =</span> <span class="st">'Surface elevation, m'</span>, <span class="dt">xlab =</span> <span class="st">'Time'</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="dt">x =</span> dat<span class="op">$</span>DateTime, </span>
<span id="cb15-6"><a href="#cb15-6"></a>      <span class="dt">y =</span> dat<span class="op">$</span>swDepth.m, <span class="dt">col =</span> <span class="st">'blue'</span>) <span class="co"># Add the original data</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">'topright'</span>,<span class="dt">legend=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Corrected'</span>,<span class="st">'Raw'</span>), <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'red'</span>,<span class="st">'blue'</span>),</span>
<span id="cb15-8"><a href="#cb15-8"></a>       <span class="dt">lty =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure">
<img src="OWHL-workflow_files/figure-html/deattenuationFigure1-1.png" alt="Comparison of the raw surface elevation (blue) and pressure-attenuation-corrected surface elevation (red). Pressure signal attenuation causes the true surface elevation fluctuation to be underestimated, and the correction attempts to undo that." width="768"><p class="caption">
Comparison of the raw surface elevation (blue) and pressure-attenuation-corrected surface elevation (red). Pressure signal attenuation causes the true surface elevation fluctuation to be underestimated, and the correction attempts to undo that.
</p>
</div>
<p>Below we’ll plot the short time series of sea surface elevations derived from our input csv files.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>cols =<span class="st"> '#E41A1C'</span>  <span class="co"># red color</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>ylabloc =<span class="st"> </span><span class="fl">3.2</span>  <span class="co"># line location for y-axis labels</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>mybg =<span class="st"> 'grey80'</span> <span class="co"># color for plot backgrounds</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>op &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="co">######################################</span></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># Plot surface elevation record</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> dat<span class="op">$</span>DateTime,</span>
<span id="cb16-8"><a href="#cb16-8"></a>        <span class="dt">y =</span> dat<span class="op">$</span>swDepthCorrected.m,</span>
<span id="cb16-9"><a href="#cb16-9"></a>        <span class="dt">type =</span> <span class="st">'n'</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylab =</span> <span class="st">''</span>, <span class="dt">xaxt=</span><span class="st">'n'</span>,</span>
<span id="cb16-10"><a href="#cb16-10"></a>        <span class="dt">xlab =</span> <span class="st">'Time'</span>, <span class="dt">col =</span> cols)</span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="kw"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span>(<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">1</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">3</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">2</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">4</span>],<span class="dt">col=</span>mybg)</span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="kw"><a href="https://rdrr.io/r/graphics/grid.html">grid</a></span>(<span class="dt">col =</span><span class="st">'white'</span>)</span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="kw"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()</span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(dat<span class="op">$</span>DateTime, </span>
<span id="cb16-15"><a href="#cb16-15"></a>        dat<span class="op">$</span>swDepthCorrected.m, <span class="dt">col =</span> cols)</span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="kw"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> ylabloc<span class="fl">+0.7</span>, <span class="dt">text =</span> <span class="st">'Surface elevation, m'</span>)</span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dt">side=</span><span class="dv">1</span>,<span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime), </span>
<span id="cb16-18"><a href="#cb16-18"></a>     <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime),<span class="dt">format=</span><span class="st">'%H:%M'</span>) )</span></code></pre></div>
<div class="figure">
<img src="OWHL-workflow_files/figure-html/waveRecordPlot-1.png" alt="Time series of surface elevations." width="768"><p class="caption">
Time series of surface elevations.
</p>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</span></code></pre></div>
<p>At this point, the de-attenuated sea surface elevation data in the <code>dat$swDepthCorrected.m</code> column can be used to calculate various wave statistics.</p>
</div>
<div id="calculating-wave-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-wave-statistics" class="anchor"></a>Calculating wave statistics</h2>
<p>Wave statistics are generally calculated for discrete chunks of time, often in the range of 15 to 30 minutes. If the original data were collected in non-contiguous chunks of time (such as a 15 minute sampling burst followed by 45 minutes of no data collection) then the time series in <code>dat</code> will already have natural boundaries for each burst to be analyzed due to gaps in the <code>DateTime</code> column values. If instead the data were collected continuously, as the OWHL is capable of doing, it would be necessary to create our own boundaries for each chunk of time to be analyzed. Our example data set in this vignette is short, so we will analyze the data in 5 minute chunks just for demonstration purposes.</p>
<p>The <code>processBursts</code> function takes several arguments. You need to provide a vector of sea surface elevations (in meters), a vector of <code>POSIXct</code> time stamps, the length of each burst you want to analyze (in minutes), the sampling rate of the sensor (default 4Hz for a OWHL), the method of analysis you want to use to generate the wave statistics (<code>sp</code> for spectral analysis, <code>zc</code> for zero-crossing wave-by-wave analysis), and the time zone of your input data.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Go through each time chunk and calculate the wave</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># height and period of the de-trended data (removing tide signal).</span></span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>wavesSP =<span class="st"> </span>owhlR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/owhlR/man/processBursts.html">processBursts</a></span>(<span class="dt">Ht =</span> dat<span class="op">$</span>swDepthCorrected.m,</span>
<span id="cb18-5"><a href="#cb18-5"></a>                          <span class="dt">times =</span> dat<span class="op">$</span>DateTime,</span>
<span id="cb18-6"><a href="#cb18-6"></a>                          <span class="dt">burstLength =</span> <span class="dv">5</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>                          <span class="dt">Fs =</span> <span class="dv">4</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>                          <span class="dt">method =</span> <span class="st">'sp'</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>                          <span class="dt">tzone =</span> <span class="st">'UTC'</span>)</span></code></pre></div>
<p>The results for the spectral analysis of wave data are shown below. The output includes:</p>
<ul>
<li><p><code>h</code> - Average water depth. Same units as input surface elevations (typically meters).</p></li>
<li><p><code>Hm0</code> - Significant wave height based on spectral moment 0. Same units as input surface heights (typically meters). This is approximately equal to the average height of the highest 1/3 of the waves.</p></li>
<li><p><code>Tp</code> - Peak period, calculated as the frequency with maximum power in the power spectrum. Units of seconds.</p></li>
<li><p><code>m0</code> - Estimated variance of time series (moment 0).</p></li>
<li><p><code>T_0_1</code> Average period calculated as <span class="math inline">\(\frac{m0}{m1}\)</span>, units seconds. Follows National Data Buoy Center’s method for average period (APD).</p></li>
<li><p><code>T_0_2</code> Average period calculated as <span class="math inline">\((\frac{m0}{m2})^{0.5}\)</span>, units seconds. Follows Scripps Institution of Oceanography’s method for calculating average period (APD) for their buoys.</p></li>
<li><p><code>EPS2</code> Spectral width parameter.</p></li>
<li><p><code>EPS4</code> Spectral width parameter.</p></li>
<li><p><code>DateTime</code> The date and time at the <em>end</em> of the burst.</p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>wavesSP</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="co">#&gt;          h       Hm0        Tp         m0    T_0_1    T_0_2      EPS2      EPS4</span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co">#&gt; 1 10.57407 0.6408342 13.333333 0.02566678 8.737863 7.883985 0.4778501 0.7194574</span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="co">#&gt; 2 10.56416 0.5840060  7.058824 0.02131644 7.612516 7.085979 0.3926009 0.6060304</span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="co">#&gt; 3 10.54523 0.6002701 15.000000 0.02252026 8.792446 8.008976 0.4530091 0.6932817</span></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co">#&gt; 4 10.52990 0.7241655 13.333333 0.03277598 9.172730 8.399655 0.4387981 0.6862758</span></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="co">#&gt;              DateTime</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#&gt; 1 2016-08-19 19:03:00</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="co">#&gt; 2 2016-08-19 19:08:00</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co">#&gt; 3 2016-08-19 19:13:00</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="co">#&gt; 4 2016-08-19 19:18:00</span></span></code></pre></div>
<p>Wave climate estimates based on spectral analysis methods are probably the more commonly used method, but the wave-by-wave analysis using the zero-crossing method is provided for interested users.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Go through each time chunk and calculate the wave</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="co"># height and period of the de-trended data (removing tide signal).</span></span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>wavesZC =<span class="st"> </span>owhlR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/owhlR/man/processBursts.html">processBursts</a></span>(<span class="dt">Ht =</span> dat<span class="op">$</span>swDepthCorrected.m,</span>
<span id="cb20-5"><a href="#cb20-5"></a>                          <span class="dt">times =</span> dat<span class="op">$</span>DateTime,</span>
<span id="cb20-6"><a href="#cb20-6"></a>                          <span class="dt">burstLength =</span> <span class="dv">5</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>                          <span class="dt">Fs =</span> <span class="dv">4</span>,</span>
<span id="cb20-8"><a href="#cb20-8"></a>                          <span class="dt">method =</span> <span class="st">'zc'</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>                          <span class="dt">tzone =</span> <span class="st">'UTC'</span>)</span></code></pre></div>
<p>The output statistics from the zero crossing algorithm are:</p>
<ul>
<li><p><code>Hsig</code> - Mean height of the highest 1/3 of waves in the data set. Units = same as input surface elevations, usually meters.</p></li>
<li><p><code>Hmean</code> - Overall mean wave height, for all waves (bigger than threshold). Units = same as input surface elevations.</p></li>
<li><p><code>H10</code> - Mean height of the upper 10% of all waves. Units = same as input surface elevations.</p></li>
<li><p><code>Hmax</code> - Maximum wave height in the input data. Units = same as input surface elevations.</p></li>
<li><p><code>Tmean</code> - Mean period of all waves (bigger than threshold). Units of seconds.</p></li>
<li><p><code>Tsig</code> - Mean period of <code>Hsig</code> (highest 1/3 of waves). Units of seconds.</p></li>
<li><p><code>DateTime</code> The date and time at the <em>end</em> of the burst.</p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>wavesZC</span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="co">#&gt;        Hsig     Hmean       H10      Hmax    Tmean      Tsig</span></span>
<span id="cb21-3"><a href="#cb21-3"></a><span class="co">#&gt; 1 0.6486270 0.3998090 0.8180052 1.0485463 8.256944 10.229167</span></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co">#&gt; 2 0.5429659 0.3715567 0.6600402 0.7112625 7.187500  9.346154</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="co">#&gt; 3 0.5750143 0.3652102 0.7228595 0.7837941 7.717105 10.000000</span></span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="co">#&gt; 4 0.6684549 0.4227043 0.8560766 1.1252348 8.104167 10.291667</span></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#&gt;              DateTime</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#&gt; 1 2016-08-19 19:03:00</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#&gt; 2 2016-08-19 19:08:00</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt; 3 2016-08-19 19:13:00</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt; 4 2016-08-19 19:18:00</span></span></code></pre></div>
<p>Next we can plot the estimated significant wave heights from the two different analysis methods (spectral and zero-crossing) for each of the analyzed bursts.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>ylims =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(wavesSP<span class="op">$</span>Hm0,wavesZC<span class="op">$</span>Hsig))</span>
<span id="cb22-2"><a href="#cb22-2"></a>op&lt;-<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> wavesSP<span class="op">$</span>DateTime,<span class="dt">y =</span> wavesSP<span class="op">$</span>Hm0, <span class="dt">type =</span> <span class="st">'n'</span>,</span>
<span id="cb22-4"><a href="#cb22-4"></a>     <span class="dt">ylab =</span> <span class="st">'Significant wave</span><span class="ch">\n</span><span class="st"> height, m'</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>     <span class="dt">xlab =</span> <span class="st">'Time'</span>,</span>
<span id="cb22-6"><a href="#cb22-6"></a>     <span class="dt">xaxt=</span><span class="st">'n'</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylim =</span> ylims)</span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span>(<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">1</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">3</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">2</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">4</span>],<span class="dt">col=</span>mybg)</span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="kw"><a href="https://rdrr.io/r/graphics/grid.html">grid</a></span>(<span class="dt">col =</span><span class="st">'white'</span>)</span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="kw"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()</span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="dt">x =</span> wavesSP<span class="op">$</span>DateTime, <span class="dt">y =</span> wavesSP<span class="op">$</span>Hm0, <span class="dt">type =</span> <span class="st">'b'</span>)</span>
<span id="cb22-11"><a href="#cb22-11"></a><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dt">side=</span><span class="dv">1</span>,<span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime), </span>
<span id="cb22-12"><a href="#cb22-12"></a>     <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime),<span class="dt">format=</span><span class="st">'%H:%M'</span>) )</span>
<span id="cb22-13"><a href="#cb22-13"></a></span>
<span id="cb22-14"><a href="#cb22-14"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="dt">x =</span> wavesZC<span class="op">$</span>DateTime, <span class="dt">y =</span> wavesZC<span class="op">$</span>Hsig, <span class="dt">type =</span> <span class="st">'b'</span>,</span>
<span id="cb22-15"><a href="#cb22-15"></a>      <span class="dt">col =</span> <span class="st">'red'</span>)</span>
<span id="cb22-16"><a href="#cb22-16"></a><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">'topleft'</span>,<span class="dt">legend=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Hm0, spectral method'</span>,<span class="st">'Hsig, zero-cross'</span>), </span>
<span id="cb22-17"><a href="#cb22-17"></a>       <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'black'</span>,<span class="st">'red'</span>), <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb22-18"><a href="#cb22-18"></a>       <span class="dt">pch =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure">
<img src="OWHL-workflow_files/figure-html/sigWavePlot-1.png" alt="Estimates of signficant wave height from each analyzed burst of samples, using either the spectral analysis method or zero-crossing method." width="768"><p class="caption">
Estimates of signficant wave height from each analyzed burst of samples, using either the spectral analysis method or zero-crossing method.
</p>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>ylims =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>,<span class="dv">25</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>op&lt;-<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="dt">x =</span> wavesSP<span class="op">$</span>DateTime,<span class="dt">y =</span> wavesSP<span class="op">$</span>Hm0, <span class="dt">type =</span> <span class="st">'n'</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>     <span class="dt">ylab =</span> <span class="st">'Period, seconds'</span>,</span>
<span id="cb24-5"><a href="#cb24-5"></a>     <span class="dt">xlab =</span> <span class="st">'Time'</span>,</span>
<span id="cb24-6"><a href="#cb24-6"></a>     <span class="dt">xaxt=</span><span class="st">'n'</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">ylim =</span> ylims)</span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="kw"><a href="https://rdrr.io/r/graphics/rect.html">rect</a></span>(<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">1</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">3</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">2</span>],<span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>()<span class="op">$</span>usr[<span class="dv">4</span>],<span class="dt">col=</span>mybg)</span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="kw"><a href="https://rdrr.io/r/graphics/grid.html">grid</a></span>(<span class="dt">col =</span><span class="st">'white'</span>)</span>
<span id="cb24-9"><a href="#cb24-9"></a><span class="kw"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()</span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="dt">x =</span> wavesSP<span class="op">$</span>DateTime, <span class="dt">y =</span> wavesSP<span class="op">$</span>Tp, <span class="dt">type =</span> <span class="st">'b'</span>)</span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dt">side=</span><span class="dv">1</span>,<span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime), </span>
<span id="cb24-12"><a href="#cb24-12"></a>     <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/pretty.html">pretty</a></span>(dat<span class="op">$</span>DateTime),<span class="dt">format=</span><span class="st">'%H:%M'</span>) )</span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="dt">x =</span> wavesZC<span class="op">$</span>DateTime, <span class="dt">y =</span> wavesZC<span class="op">$</span>Tsig, <span class="dt">type =</span> <span class="st">'b'</span>,</span>
<span id="cb24-15"><a href="#cb24-15"></a>      <span class="dt">col =</span> <span class="st">'red'</span>)</span>
<span id="cb24-16"><a href="#cb24-16"></a><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">'topleft'</span>,<span class="dt">legend=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Peak period, spectral method'</span>,</span>
<span id="cb24-17"><a href="#cb24-17"></a>                          <span class="st">'Period of upper 1/3 of waves, zero-cross'</span>), </span>
<span id="cb24-18"><a href="#cb24-18"></a>       <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'black'</span>,<span class="st">'red'</span>), <span class="dt">lty =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb24-19"><a href="#cb24-19"></a>       <span class="dt">pch =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<div class="figure">
<img src="OWHL-workflow_files/figure-html/periodPlot-1.png" alt="Estimates of wave period from each analyzed burst of samples, using either the spectral analysis method or zero-crossing method." width="768"><p class="caption">
Estimates of wave period from each analyzed burst of samples, using either the spectral analysis method or zero-crossing method.
</p>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(op)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#starting-out">Starting out</a></li>
      <li><a href="#importing-owhl-csv-files">Importing OWHL csv files</a></li>
      <li>
<a href="#converting-pressure-to-sea-surface-elevation">Converting pressure to sea surface elevation</a>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#removing-atmospheric-pressure-and-sensor-offset">Removing atmospheric pressure and sensor offset</a></li>
      <li><a href="#isolate-the-subsurface-portion-of-the-dataset">Isolate the subsurface portion of the dataset</a></li>
      <li><a href="#convert-pressure-to-sea-surface-elevation">Convert pressure to sea surface elevation</a></li>
      <li><a href="#correcting-for-pressure-attenuation">Correcting for pressure attenuation</a></li>
      <li><a href="#calculating-wave-statistics">Calculating wave statistics</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Luke Miller.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
